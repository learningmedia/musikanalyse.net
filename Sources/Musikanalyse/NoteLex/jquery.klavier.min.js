/*! jquery.klavier - v1.0.0 - 2014-03-16
* https://github.com/learningmedia/jquery.klavier
* Copyright (c) 2014 Andreas Helmberger & Ulrich Kaiser; Licensed MIT */
(function(e,t){var s=0,i=120,n=.6,r=.6,a="klavier",o=[1,3,6,8,10],l=function(e,t){e.css("position","relative").addClass(t.cssPrefix+"-container").on("click."+a,"."+t.cssPrefix+"-key",d)},c=function(t,s){var i,a,o=u.getWhiteKeyCount(s.startKey,s.endKey),l=t.innerWidth()/o,c=n*l,h=t.innerHeight(),d=r*h,f=0;for(a=s.startKey;s.endKey>=a;a++)i=u.isBlackKey(a),e("<div></div>").css({position:"absolute",width:(i?c:l)+"px",height:(i?d:h)+"px",top:"0px",left:(i?f-c/2:f)+"px",zIndex:i?s.zIndex+1:s.zIndex}).addClass(s.cssPrefix+"-key").addClass(s.cssPrefix+(i?"-black-key":"-white-key")).attr("data-value",a).appendTo(t),i||(f+=l)},h=function(t){return parseInt(e(t).data("value"),10)},d=function(e){var t=u.getOrCreate(e.delegateTarget),s=h(e.target),i=t.getSelectedValues(),n=i.indexOf(s);switch(t.options.selectionMode){case"single":i=-1===n?[s]:[];break;case"multiple":-1===n?i.push(s):i.splice(n,1);break;default:i=[]}t.setSelectedValues(i)},u=function(t,s){this.options=e.extend({},u.defaults,s),this.$el=e(t),this.$el.data(a,this),l(this.$el,this.options),c(this.$el,this.options)};u.prototype.destroy=function(){this.$el.removeData(a),this.$el.removeClass(this.options.cssPrefix+"-container"),this.$el.off("."+a),this.$el.empty(),this.$el=null},u.prototype.getSelectedValues=function(){return this.$el.find("."+this.options.cssPrefix+"-selected-key").get().map(function(e){return h(e)})},u.prototype.setSelectedValues=function(t){this.$el.find("."+this.options.cssPrefix+"-key").each(function(s,i){var n=-1!==t.indexOf(h(i));e(i).toggleClass(this.options.cssPrefix+"-selected-key",n)}.bind(this)),"function"==typeof this.options.onSelectedValuesChanged&&this.options.onSelectedValuesChanged(this.getSelectedValues())},u.getOrCreate=function(t,s){return e(t).data(a)||new u(t,s)},u.isBlackKey=function(e){var t=e%12;return-1!==o.indexOf(t)},u.getWhiteKeyCount=function(e,t){var s,i=0;for(s=e;t>=s;s++)u.isBlackKey(s)||(i+=1);return i},u.validateOptions=function(e){if(e.endKey<=e.startKey)throw Error("The end key must be greater than the start key.");if(s>e.startKey||e.endKey>i)throw Error("The key values must be grater than or equal to "+s+" and less than or euqal to "+i+".");if(u.isBlackKey(e.startKey))throw Error("The keyboard has to start with a white key.");if(u.isBlackKey(e.endKey))throw Error("The keyboard has to end with a white key.")},u.defaults={startKey:60,endKey:71,selectionMode:"multiple",cssPrefix:"klavier",zIndex:999},e.fn.klavier=function(e){var s=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var i=this.get().map(function(t){var i=u.getOrCreate(t),n=i[e].apply(i,s);return n});return i.length?i[0]:t}return this.each(function(){u.getOrCreate(this,e)})},e.fn.klavier.defaults=u.defaults,e.fn.klavier._constructor=u})(jQuery);